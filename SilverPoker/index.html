<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é“¶å§å¿«ä¹ç‰Œ</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: url('/static/background.jpg') no-repeat center center fixed;
            background-size: cover;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .game-header {
            text-align: center;
            margin: 30px 0 15px;
        }
        
        .game-header h1 {
            margin: 0;
            font-size: 36px;
            display: inline-block;
            background: linear-gradient(45deg, #9370DB, #4CAF50, #FF69B4);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(255, 105, 180, 0.3);
            padding: 15px 30px;
            position: relative;
            animation: gradientFlow 8s ease infinite;
        }
        
        .game-header h1::first-letter {
            font-size: 1.8em;
            font-family: "LiSu", "éš¶ä¹¦", "STLiti", "åæ–‡éš¶ä¹¦", cursive;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF4500);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                2px 2px 4px rgba(255, 215, 0, 0.5),
                -2px -2px 4px rgba(255, 165, 0, 0.3);
            transform: rotate(-5deg);
            display: inline-block;
            animation: 
                silverGlow 2s ease-in-out infinite,
                gradientFlow 8s ease infinite,
                floatEffect 3s ease-in-out infinite;
            position: relative;
            margin-right: 5px;
        }
        
        .game-header h1::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #9370DB, #4CAF50, #FF69B4);
            background-size: 300% 300%;
            border-radius: 5px;
            z-index: -1;
            filter: blur(15px);
            opacity: 0.3;
            animation: gradientFlow 8s ease infinite;
        }
        
        @keyframes gradientFlow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        @keyframes silverGlow {
            0%, 100% {
                filter: brightness(1);
                transform: scale(1);
            }
            50% {
                filter: brightness(1.3);
                transform: scale(1.05);
            }
        }
        
        @keyframes floatEffect {
            0%, 100% {
                transform: rotate(-5deg) translateY(0px);
            }
            50% {
                transform: rotate(-5deg) translateY(-5px);
            }
        }
        
        #player-number {
            margin-top: 10px;
            font-size: 18px;
            color: #666;
            text-align: center;
        }
        
        .room-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .room-controls input, .room-controls select {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            touch-action: manipulation;
            min-height: 44px;
            transition: all 0.3s ease;
        }
        
        .button:disabled {
            background: #cccccc !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* å¼€å§‹æ¸¸æˆæŒ‰é’® - æ·±è“åˆ°å¤©è“æ¸å˜ */
        #start-game {
            background: linear-gradient(45deg, #1E90FF, #00BFFF);
        }
        #start-game:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(30, 144, 255, 0.5);
        }
        
        /* ä¿®æ”¹åç§°æŒ‰é’® - æ©™è‰²åˆ°é‡‘è‰²æ¸å˜ */
        #change-name {
            background: linear-gradient(45deg, #FFA500, #FFD700);
        }
        #change-name:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }
        
        /* è¿‡ç‰ŒæŒ‰é’® - é›è“åˆ°é’è‰²æ¸å˜ */
        #pass {
            background: linear-gradient(45deg, #4B0082, #00CED1);
        }
        #pass:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(75, 0, 130, 0.5);
        }
        
        /* å‡ºç‰ŒæŒ‰é’® - çº¢è‰²åˆ°æ©™è‰²æ¸å˜ */
        #play-cards {
            background: linear-gradient(45deg, #DC143C, #FF8C00);
        }
        #play-cards:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.5);
        }
        
        /* å‰ç‰ŒæŒ‰é’® - ç´«ç½—å…°åˆ°è“ç»¿æ¸å˜ */
        #fork {
            background: linear-gradient(45deg, #8A2BE2, #20B2AA);
        }
        #fork:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        /* å‹¾ç‰ŒæŒ‰é’® - æ·±ç»¿åˆ°é’ç»¿æ¸å˜ */
        #hook {
            background: linear-gradient(45deg, #2E8B57, #98FB98);
        }
        #hook:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(46, 139, 87, 0.5);
        }
        
        .game-area {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-info {
            margin-bottom: 15px;
        }
        
        .game-info div {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .cards-area {
            margin: 15px 0;
            min-height: 100px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            position: relative;
        }
        
        .card {
            width: 45px;
            height: 65px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 500;
            background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%);
            cursor: grab;
            user-select: none;
            touch-action: manipulation;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                inset 0 1px 2px rgba(255, 255, 255, 0.9);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: 7px;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 2px rgba(255, 255, 255, 0.9);
        }
        
        .card.selected {
            border-color: rgba(76, 175, 80, 0.5);
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            transform: translateY(-5px);
            box-shadow: 
                0 5px 15px rgba(76, 175, 80, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.9);
        }
        
        .card.red {
            color: rgba(255, 0, 0, 0.85);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }
        
        .controls button {
            flex: 1;
            min-width: 100px;
            max-width: 200px;
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .player {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            background-color: white;
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* å½“å‰ç©å®¶æ ·å¼ */
        .player.current {
            border: 2px solid #4CAF50;
            background: linear-gradient(to bottom, #e8f5e9, #fff);
            font-weight: bold;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
        }
        
        /* è‡ªå·±çš„ç©å®¶æ¡†æ ·å¼ */
        .player.self {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-weight: bold;
            border: 2px solid #1E88E5;
            background: linear-gradient(to bottom, #E3F2FD, #fff);
            box-shadow: 0 4px 8px rgba(30, 136, 229, 0.2);
        }
        
        /* ç©å®¶åç§°æ ·å¼ */
        .player .name {
            font-size: 16px;
            margin-bottom: 5px;
            color: #333;
        }
        
        /* ç©å®¶å¡ç‰Œæ•°é‡æ ·å¼ */
        .player .card-count {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .player .score {
            margin-top: 5px;
            font-size: 14px;
            color: #666;
            padding: 3px 0;
            border-top: 1px dashed #eee;
        }
        
        /* å‰ç‰ŒçŠ¶æ€æ ·å¼ */
        .player.forking {
            border-color: #f44336;
            border-width: 3px;
            background: linear-gradient(to bottom, #ffebee, #fff);
            animation: forkPulse 0.8s infinite;
            transform: scale(1.05);
            z-index: 2;
        }
        
        /* å‹¾ç‰ŒçŠ¶æ€æ ·å¼ */
        .player.hooking {
            border-color: #2196F3;
            border-width: 3px;
            background: linear-gradient(to bottom, #e3f2fd, #fff);
            animation: hookPulse 0.8s infinite;
            transform: scale(1.05);
            z-index: 2;
        }
        
        @keyframes forkPulse {
            0% {
                box-shadow: 
                    0 0 0 0 rgba(244, 67, 54, 0.8),
                    0 0 0 0 rgba(244, 67, 54, 0.5);
            }
            25% {
                box-shadow: 
                    0 0 0 15px rgba(244, 67, 54, 0),
                    0 0 0 25px rgba(244, 67, 54, 0);
            }
            100% {
                box-shadow: 
                    0 0 0 0 rgba(244, 67, 54, 0),
                    0 0 0 0 rgba(244, 67, 54, 0);
            }
        }
        
        @keyframes hookPulse {
            0% {
                box-shadow: 
                    0 0 0 0 rgba(33, 150, 243, 0.8),
                    0 0 0 0 rgba(33, 150, 243, 0.5);
            }
            25% {
                box-shadow: 
                    0 0 0 15px rgba(33, 150, 243, 0),
                    0 0 0 25px rgba(33, 150, 243, 0);
            }
            100% {
                box-shadow: 
                    0 0 0 0 rgba(33, 150, 243, 0),
                    0 0 0 0 rgba(33, 150, 243, 0);
            }
        }
        
        /* æ·»åŠ ç –å¤´åŠ¨ç”»æ ·å¼ */
        .brick {
            position: absolute;
            width: 30px;
            height: 15px;
            background-color: #8B4513;
            border-radius: 2px;
            z-index: 1000;
            pointer-events: none;
            animation: throwBrick 0.5s ease-out forwards;
        }
        
        @keyframes throwBrick {
            0% {
                transform: scale(0.5) rotate(0deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
            }
        }
        
        #messages {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f8f8;
            max-height: 100px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .game-header h1 {
                font-size: 24px;
                padding: 10px 20px;
            }
            
            .card {
                width: 40px;
                height: 58px;
                font-size: 18px;
                border-radius: 6px;
            }
            
            .card::before {
                border-radius: 5px;
            }
            
            .button {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .controls button {
                min-width: 80px;
            }
            
            .player {
                min-width: 80px;
                padding: 8px;
                font-size: 14px;
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* æ·»åŠ ç«ç„°ç‰¹æ•ˆæ ·å¼ */
        .fire-effect {
            position: absolute;
            width: 140%;
            height: 140%;
            top: -20%;
            left: -20%;
            pointer-events: none;
            z-index: 1;
            animation: fireAnimation 2s ease-in-out;
        }
        
        .fire-effect::before,
        .fire-effect::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 20%;
            transform: translateX(-50%);
            width: 80%;
            height: 80%;
            background: 
                radial-gradient(circle at center, rgba(255,160,0,0) 0%, rgba(255,160,0,0) 50%, rgba(255,160,0,0.4) 100%),
                radial-gradient(circle at center, rgba(255,80,0,0.8) 0%, rgba(255,80,0,0) 60%),
                radial-gradient(circle at center, rgb(255,230,110) 0%, rgba(255,230,110,0) 70%);
            filter: blur(5px);
            border-radius: 50% 50% 35% 35% / 50% 50% 25% 25%;
            animation: flameMove 0.5s ease-out infinite alternate;
        }
        
        .fire-effect::after {
            width: 60%;
            height: 60%;
            bottom: 40%;
            background: 
                radial-gradient(circle at center, rgba(255,230,110,1) 0%, rgba(255,230,110,0) 50%),
                radial-gradient(circle at center, rgba(255,80,0,0.8) 0%, rgba(255,80,0,0) 60%);
            animation: flameMove 0.7s ease-out infinite alternate-reverse;
        }
        
        @keyframes flameMove {
            0% {
                transform: translateX(-50%) scaleY(1) scaleX(1);
                filter: blur(5px);
            }
            100% {
                transform: translateX(-50%) scaleY(1.1) scaleX(0.9);
                filter: blur(7px);
            }
        }
        
        @keyframes fireAnimation {
            0% { opacity: 0; transform: scale(0.8); }
            20% { opacity: 1; transform: scale(1); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        
        /* æ·»åŠ æ–‡å­—åŠ¨ç”»æ ·å¼ */
        .hot-text {
            position: absolute;
            top: 65%;  /* è°ƒæ•´åˆ°ä¸‹æ–¹ */
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 
                0 0 4px rgba(255, 100, 0, 0.8),
                0 0 8px rgba(255, 50, 0, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.5);
            opacity: 0;
            animation: textAnimation 2s ease-in-out;
            pointer-events: none;
            z-index: 2;
            white-space: nowrap;
        }
        
        @keyframes textAnimation {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
        
        /* æ·»åŠ æµæ³ªè¡¨æƒ…æ ·å¼ */
        .cry-emoji {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            opacity: 0;
            pointer-events: none;
            z-index: 2;
            animation: cryAnimation 1.5s ease-out forwards;
        }
        
        @keyframes cryAnimation {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) translateY(20px); }
        }
        
        /* æ·»åŠ å‘æ€’è¡¨æƒ…æ ·å¼ */
        .angry-emoji {
            position: absolute;
            top: 35%;  /* è°ƒæ•´åˆ°ä¸Šæ–¹ */
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            opacity: 0;
            pointer-events: none;
            z-index: 2;
            animation: angryAnimation 2s ease-out forwards;
        }
        
        @keyframes angryAnimation {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) translateY(-20px); }
        }
        
        /* æ·»åŠ é“¶å§æ¢è£…æŒ‰é’®æ ·å¼ */
        #change-background {
            background: linear-gradient(45deg, #FF69B4, #9370DB);
            border: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        #change-background:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(147, 112, 219, 0.5);
        }
        
        /* æ·»åŠ è¡£ç‰©è¡¨æƒ…åŠ¨ç”»æ ·å¼ */
        .clothes-emoji {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 1000;
            animation: flyClothes 1s ease-out forwards;
        }
        
        @keyframes flyClothes {
            0% {
                opacity: 1;
                transform: scale(0.5) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) rotate(360deg) translate(var(--tx), var(--ty));
            }
        }
        
        /* åˆ›å»ºæˆ¿é—´æŒ‰é’® - ç´«è‰²åˆ°ç²‰è‰²æ¸å˜ */
        #create-room {
            background: linear-gradient(45deg, #9932CC, #FF69B4);
        }
        #create-room:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(153, 50, 204, 0.5);
        }

        /* åŠ å…¥æˆ¿é—´æŒ‰é’® - è“ç»¿åˆ°é’è‰²æ¸å˜ */
        #join-room {
            background: linear-gradient(45deg, #20B2AA, #7FFFD4);
        }
        #join-room:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(32, 178, 170, 0.5);
        }

        /* é€‰æ‹©ç‰Œæ•°ä¸‹æ‹‰æ¡† - é‡‘è‰²åˆ°ç¥ç€è‰²æ¸å˜ */
        #deck-count {
            background: linear-gradient(45deg, #DAA520, #D2691E);
            color: white;
            cursor: pointer;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            appearance: none;
            -webkit-appearance: none;
            position: relative;
            text-align: center;
            text-align-last: center;
        }
        #deck-count:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(218, 165, 32, 0.5);
        }
        #deck-count option {
            background: #DAA520;
            color: white;
        }

        /* æˆ¿é—´å·è¾“å…¥æ¡†æ ·å¼ */
        #room-id {
            border: 2px solid transparent;
            border-image: linear-gradient(45deg, #FF8C00, #FFD700) 1;
            background: white;
            color: #333;
            transition: all 0.3s ease;
        }
        #room-id:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 140, 0, 0.3);
            border-image: linear-gradient(45deg, #FFD700, #FF8C00) 1;
        }

        .last-cards h3 {
            color: #444;
            font-size: 18px;
            padding: 8px 0;
            margin: 0 0 10px 0;
            border-bottom: 2px solid #ddd;
            position: relative;
        }

        .last-cards h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, #666, #ddd);
        }

        .card.dragging {
            opacity: 0.8;
            cursor: grabbing;
            transform: scale(1.1) rotate(2deg);
            z-index: 1000;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.9);
            transition: none;
        }

        /* æ‹–æ‹½ç›®æ ‡ä½ç½®æŒ‡ç¤ºå™¨ */
        .card-drop-indicator {
            width: 4px;
            height: 70px;
            background: linear-gradient(to bottom, 
                rgba(76, 175, 80, 0.8) 0%,
                rgba(76, 175, 80, 1) 50%,
                rgba(76, 175, 80, 0.8) 100%);
            border-radius: 2px;
            position: absolute;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
            transition: all 0.1s ease;
            z-index: 999;
        }

        /* åˆ·æ–°æŒ‰é’® - ç»¿è‰²åˆ°é’è‰²æ¸å˜ */
        #refresh-game {
            background: linear-gradient(45deg, #32CD32, #00CED1);
        }
        #refresh-game:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(50, 205, 50, 0.5);
        }

        /* é€‰æ‹©çº¿è·¯æŒ‰é’® - è“ç´«æ¸å˜ */
        #select-server {
            background: linear-gradient(45deg, #4169E1, #9370DB);
        }
        #select-server:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(65, 105, 225, 0.5);
        }

        /* çº¿è·¯é€‰æ‹©å¯¹è¯æ¡†æ ·å¼ */
        .server-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 300px;
        }

        .server-dialog h3 {
            margin-top: 0;
            color: #333;
            text-align: center;
        }

        .server-option {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .server-option:hover {
            background: #e0e0e0;
        }

        .custom-server-input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: none;
        }

        .server-dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1>é“¶å§å¿«ä¹ç‰Œ</h1>
            <button id="change-background" class="button" style="margin-top: 10px;">é“¶å§æ¢è£…</button>
            <div id="player-number"></div>
        </div>
        <div id="message"></div>
        <div id="game-status"></div>
        
        <div id="login-section">
            <div class="room-controls">
                <select id="deck-count" class="button">
                    <option value="1">1å‰¯ç‰Œ</option>
                    <option value="2">2å‰¯ç‰Œ</option>
                </select>
                <button id="select-server" class="button">é€‰æ‹©çº¿è·¯</button>
                <button id="create-room" class="button">åˆ›å»ºæˆ¿é—´</button>
                <input type="text" id="room-id" placeholder="è¾“å…¥æˆ¿é—´å·">
                <button id="join-room" class="button">åŠ å…¥æˆ¿é—´</button>
            </div>
        </div>
        
        <div id="game-section" style="display: none;">
            <div id="room-info" class="game-info"></div>
            <button id="start-game" class="button">å¼€å§‹æ¸¸æˆ</button>
            <button id="change-name" class="button" style="margin-left: 10px;">ä¿®æ”¹åç§°</button>
            <button id="refresh-game" class="button" style="margin-left: 10px;">åˆ·æ–°</button>
            
            <div class="player-list" id="player-list">
                <!-- ç©å®¶ä¿¡æ¯å°†åŠ¨æ€æ·»åŠ  -->
            </div>
            
            <div class="last-cards" id="last-cards">
                <h3>ä¸Šä¸€æ‰‹ç‰Œ</h3>
                <!-- ä¸Šä¸€æ‰‹ç‰Œå°†åŠ¨æ€æ·»åŠ  -->
            </div>
            
            <div id="player-cards" class="cards-area"></div>
            
            <div id="game-controls" class="controls">
                <button id="pass" class="button">è¿‡</button>
                <button id="play-cards" class="button">å‡ºç‰Œ</button>
                <button id="fork" class="button" style="display: none;">å‰ç‰Œ</button>
                <button id="hook" class="button" style="display: none;">å‹¾ç‰Œ</button>
            </div>
        </div>
    </div>
    
    <div class="server-dialog-overlay"></div>
    <div class="server-dialog">
        <h3>é€‰æ‹©æœåŠ¡å™¨çº¿è·¯</h3>
        <button class="server-option" data-server="hk">çº¿è·¯1: é¦™æ¸¯æœåŠ¡å™¨</button>
        <button class="server-option" data-server="tx">çº¿è·¯2: è…¾è®¯æœåŠ¡å™¨</button>
        <button class="server-option" data-server="custom">çº¿è·¯3: è‡ªå®šä¹‰çº¿è·¯</button>
        <input type="text" class="custom-server-input" placeholder="è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€">
    </div>
    
    <script>
        let ws = null;
        let selectedCards = new Set();
        let currentPlayerIndex = -1;
        let playerCount = 0;
        let lastJoinClickTime = 0;
        let currentServer = null;  // å­˜å‚¨å½“å‰é€‰æ‹©çš„æœåŠ¡å™¨

        const SERVER_URLS = {
            'hk': 'wss://silverpoker.redheartco.shop/game',  // é¦™æ¸¯æœåŠ¡å™¨åœ°å€
            'tx': 'wss://django-6h56-136494-9-1337520003.sh.run.tcloudbase.com/game'  // è…¾è®¯æœåŠ¡å™¨ä½¿ç”¨é»˜è®¤æœ¬åœ°æœåŠ¡å™¨
        };
        
        function showMessage(msg, isError = true) {
            const msgEl = document.getElementById('message');
            msgEl.textContent = msg;
            msgEl.style.color = isError ? '#f44336' : '#4CAF50';
            setTimeout(() => msgEl.textContent = '', 3000);
        }
        
        function isRedCard(card) {
            return card.startsWith('â™¥') || card.startsWith('â™¦');
        }
        
        document.getElementById('select-server').onclick = () => {
            document.querySelector('.server-dialog').style.display = 'block';
            document.querySelector('.server-dialog-overlay').style.display = 'block';
        };

        document.querySelector('.server-dialog-overlay').onclick = () => {
            document.querySelector('.server-dialog').style.display = 'none';
            document.querySelector('.server-dialog-overlay').style.display = 'none';
        };

        document.querySelectorAll('.server-option').forEach(button => {
            button.onclick = () => {
                const serverType = button.dataset.server;
                if (serverType === 'custom') {
                    document.querySelector('.custom-server-input').style.display = 'block';
                } else {
                    currentServer = SERVER_URLS[serverType];
                    document.querySelector('.server-dialog').style.display = 'none';
                    document.querySelector('.server-dialog-overlay').style.display = 'none';
                    if (serverType === 'tx') {
                        showMessage('å·²é€‰æ‹©è…¾è®¯æœåŠ¡å™¨ï¼ˆé»˜è®¤çº¿è·¯ï¼‰', false);
                    } else {
                        showMessage(`å·²é€‰æ‹©${button.textContent}`, false);
                    }
                }
            };
        });

        document.querySelector('.custom-server-input').onchange = (e) => {
            currentServer = e.target.value;
            document.querySelector('.server-dialog').style.display = 'none';
            document.querySelector('.server-dialog-overlay').style.display = 'none';
            showMessage('å·²è®¾ç½®è‡ªå®šä¹‰æœåŠ¡å™¨', false);
        };

        function createWebSocketConnection() {
            if (!currentServer) {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                return new WebSocket(`${protocol}//${window.location.host}/game`);
            }
            return new WebSocket(currentServer);
        }
        
        document.getElementById('create-room').addEventListener('click', function() {
            const deckCount = document.getElementById('deck-count').value;
            console.log('åˆ›å»ºæˆ¿é—´ï¼Œä½¿ç”¨ç‰Œç»„æ•°é‡:', deckCount);  
            ws = createWebSocketConnection();
            ws.onopen = function() {
                ws.send(JSON.stringify({
                    action: 'create_room',
                    deck_count: parseInt(deckCount)
                }));
            };
            ws.onerror = function(error) {
                console.error('WebSocket é”™è¯¯:', error);
                showMessage('è¿æ¥é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            };
            ws.onmessage = function(event) {
                console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                const data = JSON.parse(event.data);
                
                switch(data.action) {
                    case 'room_created':
                        document.getElementById('room-info').textContent = 'æˆ¿é—´å·ï¼š' + data.room_id;
                        document.getElementById('login-section').style.display = 'none';
                        document.getElementById('game-section').style.display = 'block';
                        showMessage('æˆ¿é—´åˆ›å»ºæˆåŠŸï¼', false);
                        alert('åˆ›å»ºæˆ¿é—´çš„ğŸ¦ï¼Œè¯·åˆ·æ–°é¡µé¢åï¼Œé€šè¿‡æœç´¢æˆ¿å·åŠ å…¥æˆ¿é—´');
                        break;
                        
                    case 'joined_room':
                        if (data.success) {
                            document.getElementById('login-section').style.display = 'none';
                            document.getElementById('game-section').style.display = 'block';
                            document.getElementById('room-info').textContent = 'æˆ¿é—´å·ï¼š' + document.getElementById('room-id').value;
                            showMessage('æˆåŠŸåŠ å…¥æˆ¿é—´ï¼', false);
                        } else {
                            showMessage(data.message);
                        }
                        break;
                        
                    case 'room_state':
                        playerCount = data.player_count;
                        const roomInfo = document.getElementById('room-info');
                        if (!roomInfo.textContent.includes('ç©å®¶')) {
                            roomInfo.textContent += ` (${playerCount}/6 ç©å®¶)`;
                        } else {
                            roomInfo.textContent = roomInfo.textContent.replace(/\(\d+\/6 ç©å®¶\)/, `(${playerCount}/6 ç©å®¶)`);
                        }
                        break;
                        
                    case 'throw_brick':
                        // æ¥æ”¶å¹¶æ˜¾ç¤ºå…¶ä»–ç©å®¶æ‰”ç –å¤´çš„åŠ¨ç”»
                        showThrowBrickAnimation(data.from_player, data.to_player);
                        break;
                        
                    case 'show_fire':
                        // æ¥æ”¶å¹¶æ˜¾ç¤ºç«ç„°ç‰¹æ•ˆ
                        showFireEffect(data.player_index);
                        break;
                        
                    case 'game_state':
                        updateGameState(data);
                        break;
                        
                    case 'game_over':
                        handleGameOver(data);
                        break;
                        
                    case 'show_thanks':
                        alert(data.message);
                        break;
                        
                    case 'error':
                        showMessage(data.message);
                        break;
                }
            };
        });
        
        function updateGameState(data) {
            // æ›´æ–°æ‰‹ç‰Œ
            displayCards(data.cards);
            
            // æ›´æ–°ç©å®¶åˆ—è¡¨
            updatePlayerList(data);
            
            // æ›´æ–°ä¸Šä¸€æ‰‹ç‰Œ
            const lastCardsDiv = document.getElementById('last-cards');
            lastCardsDiv.innerHTML = '<h3>ä¸Šä¸€æ‰‹ç‰Œ</h3>';
            
            // // æ˜¾ç¤ºå‰ç‰Œä¿¡æ¯
            // if (data.fork_info) {
            //     lastCardsDiv.innerHTML += `${data.fork_info.player_name} å‰ç‰Œï¼š${data.fork_info.cards.join(', ')}<br>`;
            // }
            
            // // æ˜¾ç¤ºå‹¾ç‰Œä¿¡æ¯
            // if (data.hook_info) {
            //     lastCardsDiv.innerHTML += `${data.hook_info.player_name} å‹¾ç‰Œï¼š${data.hook_info.cards.join(', ')}<br>`;
            // }
            
            // æ˜¾ç¤ºæ™®é€šå‡ºç‰Œä¿¡æ¯
            if (data.last_cards) {
                const playerInfo = data.last_cards.player_name ? `${data.last_cards.player_name}ï¼š` : '';
                lastCardsDiv.innerHTML += `${playerInfo}${data.last_cards.cards.join(', ')}`;
            } else if (!data.fork_info && !data.hook_info) {
                lastCardsDiv.innerHTML += 'æ— ';
            }
            
            // æ›´æ–°ç©å®¶ç¼–å·æ˜¾ç¤º
            const playerNumberDiv = document.getElementById('player-number');
            const playerName = data.player_names[data.player_number] || `ç©å®¶${data.player_number + 1}`;
            playerNumberDiv.textContent = `ä½ æ˜¯${playerName}`;
            
            // æ›´æ–°æ§åˆ¶æŒ‰é’®
            updateControls(data);
        }
        
        function updatePlayerList(data) {
            const container = document.getElementById('player-list');
            container.innerHTML = '';
            
            for (let i = 0; i < Object.keys(data.player_card_counts).length; i++) {
                const div = document.createElement('div');
                let className = 'player';
                
                // æ·»åŠ å½“å‰ç©å®¶é«˜äº®
                if (i === currentPlayerIndex) {
                    className += ' current';
                }
                
                // æ·»åŠ è‡ªå·±çš„æ ·å¼
                if (i === data.player_number) {
                    className += ' self';
                }
                
                // æ·»åŠ å‰ç‰Œå’Œå‹¾ç‰Œçš„é«˜äº®æ•ˆæœ
                if (data.fork_player !== undefined && data.player_names[i] === data.player_names[data.fork_player] && data.waiting_for_hook) {
                    className += ' forking';
                }
                if (data.hook_player !== undefined && data.player_names[i] === data.player_names[data.hook_player]) {
                    className += ' hooking';
                }
                
                div.className = className;
                div.dataset.playerIndex = i;
                
                const score = data.scores[i] || 0;
                const name = data.player_names[i] || `ç©å®¶${i + 1}`;
                
                // ä½¿ç”¨æ–°çš„HTMLç»“æ„
                div.innerHTML = `
                    <div class="name">${name}</div>
                    <div class="card-count">${data.player_card_counts[i]}å¼ ç‰Œ</div>
                    <div class="score">å¾—åˆ†: ${score}</div>
                `;
                
                // ä¸ºæ¯ä¸ªç©å®¶æ–¹æ¡†æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆé™¤äº†è‡ªå·±ï¼‰
                if (i !== data.player_number) {
                    div.style.cursor = 'pointer';
                    div.addEventListener('click', function(e) {
                        ws.send(JSON.stringify({
                            action: 'throw_brick',
                            from_player: data.player_number,
                            to_player: i
                        }));
                    });
                } else {
                    div.style.cursor = 'pointer';
                    div.addEventListener('click', function(e) {
                        ws.send(JSON.stringify({
                            action: 'show_fire',
                            player_index: data.player_number
                        }));
                    });
                }
                
                container.appendChild(div);
            }
        }
        
        function updateControls(data) {
            const playButton = document.getElementById('play-cards');
            const passButton = document.getElementById('pass');
            const forkButton = document.getElementById('fork');
            const hookButton = document.getElementById('hook');
            
            // æ¸…é™¤é”™è¯¯æç¤º
            showMessage('', false);
            
            // å¦‚æœç©å®¶æ²¡æœ‰ç‰Œäº†ï¼Œä¸”ä¸åœ¨å‰ç‰Œæˆ–å‹¾ç‰Œé˜¶æ®µæ—¶ï¼Œè‡ªåŠ¨è¿‡ç‰Œ
            if (data.current_player && data.cards && data.cards.length === 0 && !data.can_fork && !data.waiting_for_hook) {
                ws.send(JSON.stringify({action: 'pass'}));
                return;
            }
            
            // å¦‚æœåœ¨ç­‰å¾…å‹¾ç‰Œï¼Œåªæ˜¾ç¤ºå‹¾ç‰Œå’Œè¿‡ç‰ŒæŒ‰é’®
            if (data.waiting_for_hook) {
                playButton.disabled = true;
                forkButton.style.display = 'none';
                hookButton.style.display = data.can_hook ? 'inline-block' : 'none';
                passButton.disabled = false;  // å§‹ç»ˆå…è®¸è¿‡ç‰Œ
                
                // if (data.can_hook) {
                //     showMessage('æœ‰ç©å®¶å‰ç‰Œï¼Œä½ å¯ä»¥å‹¾ç‰Œæˆ–è¿‡ç‰Œ', false);
                // } else {
                //     showMessage('æœ‰ç©å®¶å‰ç‰Œï¼Œè¯·é€‰æ‹©æ˜¯å¦è¿‡ç‰Œ', false);
                // }
                return;
            }
            
            // å¦‚æœå¯ä»¥å‰ç‰Œï¼Œåªæ˜¾ç¤ºå‰ç‰Œå’Œè¿‡ç‰ŒæŒ‰é’®
            if (data.can_fork) {
                playButton.disabled = true;
                hookButton.style.display = 'none';
                forkButton.style.display = 'inline-block';
                passButton.disabled = false;  // å…è®¸è¿‡ç‰Œ
                // showMessage('æœ‰ç©å®¶å‡ºå•ç‰Œï¼Œä½ å¯ä»¥é€‰æ‹©å‰ç‰Œæˆ–è¿‡ç‰Œ', false);
                return;
            }
            
            // æ­£å¸¸å‡ºç‰ŒçŠ¶æ€
            playButton.disabled = !data.current_player;
            // ç»™å…‰æœºåˆ¶ï¼šå¦‚æœæ˜¯ç»™å…‰çŠ¶æ€ï¼Œå…è®¸è‡ªç”±å‡ºç‰Œ
            if (data.is_giving_light) {
                playButton.disabled = !data.current_player;
                passButton.disabled = !data.current_player;
                // showMessage('ç»™å…‰çŠ¶æ€ï¼šå¯ä»¥è‡ªç”±å‡ºç‰Œ', false);
            } else {
                passButton.disabled = !data.current_player || !data.last_cards;
            }
            forkButton.style.display = 'none';
            hookButton.style.display = 'none';
            
            if (data.current_player) {
                // åˆ é™¤æç¤ºï¼Œç›´æ¥å¯ç”¨æŒ‰é’®
                enableButtons();
            } else {
                disableButtons();
            }
        }
        
        function displayCards(cards) {
            const cardsContainer = document.getElementById('player-cards');
            cardsContainer.innerHTML = '';
            
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card' + (isRedCard(card) ? ' red' : '');
                cardElement.textContent = card;
                cardElement.dataset.card = card;
                
                // æ·»åŠ æ‹–æ‹½å±æ€§
                cardElement.draggable = true;
                
                // æ‹–æ‹½å¼€å§‹äº‹ä»¶
                cardElement.addEventListener('dragstart', function(e) {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', card);
                    this.classList.add('dragging');
                });
                
                // æ‹–æ‹½ç»“æŸäº‹ä»¶
                cardElement.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    document.querySelectorAll('.card-drop-indicator').forEach(el => el.remove());
                });
                
                // ç‚¹å‡»é€‰ç‰Œäº‹ä»¶
                cardElement.addEventListener('click', function(e) {
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                    } else {
                        const forkButton = document.getElementById('fork');
                        if (forkButton.style.display === 'inline-block') {
                            const selectedCards = document.querySelectorAll('.card.selected');
                            if (selectedCards.length >= 2) {
                                selectedCards[0].classList.remove('selected');
                            }
                        }
                        this.classList.add('selected');
                    }
                    showMessage('', false);
                });
                
                cardsContainer.appendChild(cardElement);
            });
            
            // ä¸ºå¡ç‰Œå®¹å™¨æ·»åŠ æ‹–æ‹½ç›¸å…³äº‹ä»¶
            cardsContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const draggingCard = document.querySelector('.dragging');
                if (!draggingCard) return;
                
                document.querySelectorAll('.card-drop-indicator').forEach(el => el.remove());
                
                const afterElement = getDragAfterElement(this, e.clientX);
                const indicator = document.createElement('div');
                indicator.className = 'card-drop-indicator';
                
                if (afterElement) {
                    const rect = afterElement.getBoundingClientRect();
                    indicator.style.left = (rect.left - 2) + 'px';
                    indicator.style.top = (rect.top - 2) + 'px';
                    this.insertBefore(indicator, afterElement);
                } else {
                    const lastCard = this.lastElementChild;
                    if (lastCard) {
                        const rect = lastCard.getBoundingClientRect();
                        indicator.style.left = (rect.right + 2) + 'px';
                        indicator.style.top = (rect.top - 2) + 'px';
                    }
                    this.appendChild(indicator);
                }
            });
            
            cardsContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                const draggingCard = document.querySelector('.dragging');
                if (!draggingCard) return;
                
                document.querySelectorAll('.card-drop-indicator').forEach(el => el.remove());
                
                const afterElement = getDragAfterElement(this, e.clientX);
                if (afterElement) {
                    this.insertBefore(draggingCard, afterElement);
                } else {
                    this.appendChild(draggingCard);
                }
                
                updateCardsOrder();
            });
        }
        
        // è·å–æ‹–æ‹½ç›®æ ‡ä½ç½®çš„è¾…åŠ©å‡½æ•°
        function getDragAfterElement(container, x) {
            const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
            
            // ä¼˜åŒ–ï¼šå¦‚æœæ²¡æœ‰å…¶ä»–å¡ç‰Œï¼Œç›´æ¥è¿”å› null
            if (draggableElements.length === 0) return null;
            
            // ä¼˜åŒ–ï¼šä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æé«˜æ€§èƒ½
            let start = 0;
            let end = draggableElements.length - 1;
            
            while (start <= end) {
                const mid = Math.floor((start + end) / 2);
                const box = draggableElements[mid].getBoundingClientRect();
                const offset = x - box.left - box.width / 2;
                
                if (offset < 0) {
                    if (mid === 0 || x - draggableElements[mid - 1].getBoundingClientRect().right > 0) {
                        return draggableElements[mid];
                    }
                    end = mid - 1;
                } else {
                    start = mid + 1;
                }
            }
            
            return null;
        }
        
        // æ›´æ–°æ‰‹ç‰Œé¡ºåºçš„å‡½æ•°
        function updateCardsOrder() {
            const cardsContainer = document.getElementById('player-cards');
            const cards = [];
            cardsContainer.querySelectorAll('.card').forEach(card => {
                cards.push(card.dataset.card);
            });
            
            // ä½¿ç”¨é˜²æŠ–æ¥é¿å…é¢‘ç¹å‘é€è¯·æ±‚
            if (window.updateOrderTimeout) {
                clearTimeout(window.updateOrderTimeout);
            }
            window.updateOrderTimeout = setTimeout(() => {
                if (ws) {
                    ws.send(JSON.stringify({
                        action: 'update_cards_order',
                        cards: cards
                    }));
                }
            }, 100);  // 100ms çš„é˜²æŠ–å»¶è¿Ÿ
        }
        
        function getSelectedCards() {
            const selectedCards = [];
            document.querySelectorAll('.card.selected').forEach(card => {
                selectedCards.push(card.dataset.card);
            });
            return selectedCards;
        }
        
        function handleFork() {
            const selectedCards = getSelectedCards();
            if (selectedCards.length !== 2) {
                showMessage('å‰ç‰Œéœ€è¦é€‰ä¸­ä¸€å¯¹ç‰Œ', true);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç›¸åŒç‚¹æ•°çš„ç‰Œ
            if (selectedCards[0].slice(1) !== selectedCards[1].slice(1)) {
                showMessage('å‰ç‰Œå¿…é¡»æ˜¯ç›¸åŒç‚¹æ•°çš„å¯¹å­', true);
                return;
            }
            
            ws.send(JSON.stringify({
                'action': 'play_cards',
                'cards': selectedCards
            }));
        }
        
        function handleHook() {
            const selectedCards = getSelectedCards();
            if (selectedCards.length !== 1) {
                showMessage('å‹¾ç‰Œéœ€è¦é€‰ä¸­ä¸€å¼ ç‰Œ', true);
                return;
            }
            
            ws.send(JSON.stringify({
                'action': 'play_cards',
                'cards': selectedCards
            }));
        }
        
        function handlePlayCards() {
            const selectedCards = getSelectedCards();
            if (selectedCards.length === 0) {
                showMessage('è¯·é€‰æ‹©è¦å‡ºçš„ç‰Œ', true);
                return;
            }
            
            ws.send(JSON.stringify({
                'action': 'play_cards',
                'cards': selectedCards
            }));
        }
        
        // è®¾ç½®æŒ‰é’®äº‹ä»¶å¤„ç†
        document.getElementById('play-cards').onclick = handlePlayCards;
        document.getElementById('pass').onclick = () => {
            ws.send(JSON.stringify({action: 'pass'}));
        };
        document.getElementById('fork').onclick = handleFork;
        document.getElementById('hook').onclick = handleHook;
        
        document.getElementById('join-room').onclick = () => {
            const now = Date.now();
            if (now - lastJoinClickTime < 5000) {
                return;
            }
            lastJoinClickTime = now;
            
            const roomId = document.getElementById('room-id').value;
            if (!roomId) {
                showMessage('è¯·è¾“å…¥æˆ¿é—´å·');
                return;
            }
            ws = createWebSocketConnection();
            ws.onopen = function() {
                ws.send(JSON.stringify({
                    action: 'join_room',
                    room_id: roomId
                }));
            };
            ws.onerror = function(error) {
                console.error('WebSocket é”™è¯¯:', error);
                showMessage('è¿æ¥é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            };
            ws.onmessage = function(event) {
                console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                const data = JSON.parse(event.data);
                
                switch(data.action) {
                    case 'room_created':
                        document.getElementById('room-info').textContent = 'æˆ¿é—´å·ï¼š' + data.room_id;
                        document.getElementById('login-section').style.display = 'none';
                        document.getElementById('game-section').style.display = 'block';
                        showMessage('æˆ¿é—´åˆ›å»ºæˆåŠŸï¼', false);
                        break;
                        
                    case 'joined_room':
                        if (data.success) {
                            document.getElementById('login-section').style.display = 'none';
                            document.getElementById('game-section').style.display = 'block';
                            document.getElementById('room-info').textContent = 'æˆ¿é—´å·ï¼š' + document.getElementById('room-id').value;
                            showMessage('æˆåŠŸåŠ å…¥æˆ¿é—´ï¼', false);
                        } else {
                            showMessage(data.message);
                        }
                        break;
                        
                    case 'room_state':
                        playerCount = data.player_count;
                        const roomInfo = document.getElementById('room-info');
                        if (!roomInfo.textContent.includes('ç©å®¶')) {
                            roomInfo.textContent += ` (${playerCount}/6 ç©å®¶)`;
                        } else {
                            roomInfo.textContent = roomInfo.textContent.replace(/\(\d+\/6 ç©å®¶\)/, `(${playerCount}/6 ç©å®¶)`);
                        }
                        break;
                        
                    case 'throw_brick':
                        // æ¥æ”¶å¹¶æ˜¾ç¤ºå…¶ä»–ç©å®¶æ‰”ç –å¤´çš„åŠ¨ç”»
                        showThrowBrickAnimation(data.from_player, data.to_player);
                        break;
                        
                    case 'show_fire':
                        // æ¥æ”¶å¹¶æ˜¾ç¤ºç«ç„°ç‰¹æ•ˆ
                        showFireEffect(data.player_index);
                        break;
                        
                    case 'game_state':
                        updateGameState(data);
                        break;
                        
                    case 'game_over':
                        handleGameOver(data);
                        break;
                        
                    case 'show_thanks':
                        alert(data.message);
                        break;
                        
                    case 'error':
                        showMessage(data.message);
                        break;
                }
            };
        };
        
        document.getElementById('start-game').onclick = () => {
            ws.send(JSON.stringify({action: 'start_game'}));
        };
        
        // ä¿®æ”¹åç§°åŠŸèƒ½
        document.getElementById('change-name').onclick = () => {
            const newName = prompt('è¯·è¾“å…¥æ–°çš„åç§°ï¼š');
            if (newName && newName.trim()) {
                ws.send(JSON.stringify({
                    action: 'change_name',
                    name: newName.trim()
                }));
            }
        };
        
        // é“¶å§æ¢è£…åŠŸèƒ½
        document.getElementById('change-background').onclick = () => {
            const backgrounds = ['p1.jpg', 'p2.jpg', 'p3.jpg', 'p4.jpg', 'p5.jpg','7.jpg','8.jpg','9.jpg','10.jpg','11.jpg','12.jpg','13.jpg','14.jpg','15.jpg','16.jpg','17.jpg','18.jpg','19.jpg'];
            const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
            document.body.style.backgroundImage = `url('/static/${randomBg}')`;
            
            // åˆ›å»ºé£å‡ºçš„è¡£ç‰©è¡¨æƒ…
            const clothes = ['ğŸ‘•', 'ğŸ‘–', 'ğŸ‘—', 'ğŸ‘ ', 'ğŸ‘¢', 'ğŸ‘š', 'ğŸ‘”', 'ğŸ‘’'];
            const button = document.getElementById('change-background');
            const rect = button.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // åˆ›å»º6ä¸ªéšæœºè¡£ç‰©è¡¨æƒ…
            for (let i = 0; i < 6; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'clothes-emoji';
                emoji.textContent = clothes[Math.floor(Math.random() * clothes.length)];
                
                // éšæœºé£è¡Œæ–¹å‘
                const angle = (Math.PI * 2 * i / 6) + (Math.random() * 0.5 - 0.25);
                const distance = 100 + Math.random() * 50;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                // è®¾ç½®åˆå§‹ä½ç½®
                emoji.style.left = centerX + 'px';
                emoji.style.top = centerY + 'px';
                emoji.style.setProperty('--tx', `${tx}px`);
                emoji.style.setProperty('--ty', `${ty}px`);
                
                document.body.appendChild(emoji);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => emoji.remove(), 1000);
            }
        };
        
        function sendMessage(data) {
            console.log('å‘é€æ¶ˆæ¯:', data);
            ws.send(JSON.stringify(data));
        }
        
        function handleGameOver(data) {
            // æ„å»ºæ¸¸æˆç»“æŸæ¶ˆæ¯
            let message = 'æ¸¸æˆç»“æŸï¼\n\n';
            
            // æ·»åŠ è·èƒœè€…ä¿¡æ¯å’Œç§¯åˆ†å˜åŒ–
            message += 'è·èƒœè€…ï¼š\n';
            for (let [playerIndex, totalScore, scoreChange] of data.scores.winners) {
                const playerName = data.player_names[playerIndex];
                message += `${playerName}: ${scoreChange >= 0 ? '+' : ''}${scoreChange} åˆ† (æ€»åˆ†: ${totalScore})\n`;
            }
            
            // æ·»åŠ å¤±è´¥è€…ä¿¡æ¯å’Œç§¯åˆ†å˜åŒ–
            message += '\nå¤±è´¥è€…ï¼š\n';
            const [loserIndex, loserTotalScore, loserScoreChange] = data.scores.loser;
            const loserName = data.player_names[loserIndex];
            message += `${loserName}: ${loserScoreChange >= 0 ? '+' : ''}${loserScoreChange} åˆ† (æ€»åˆ†: ${loserTotalScore})\n`;
            
            message += '\nå¯ä»¥ç‚¹å‡»å¼€å§‹æ¸¸æˆæŒ‰é’®å¼€å§‹æ–°çš„ä¸€å±€';
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—
            alert(message);
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            document.getElementById('game-section').style.display = 'block';
            document.getElementById('last-cards').innerHTML = '<h3>ä¸Šä¸€æ‰‹ç‰Œ</h3>æ— ';
            document.getElementById('player-cards').innerHTML = '';
            document.getElementById('player-list').innerHTML = '';
            document.getElementById('start-game').disabled = false;
        }
        
        // æ·»åŠ æ‰”ç –å¤´åŠ¨ç”»å‡½æ•°
        function showThrowBrickAnimation(fromPlayerIndex, toPlayerIndex) {
            // è·å–ç©å®¶æ–¹æ¡†å…ƒç´ 
            const fromPlayer = document.querySelector(`.player[data-player-index="${fromPlayerIndex}"]`);
            const toPlayer = document.querySelector(`.player[data-player-index="${toPlayerIndex}"]`);
            
            if (!fromPlayer || !toPlayer) return;
            
            // åˆ›å»ºç –å¤´å…ƒç´ 
            const brick = document.createElement('div');
            brick.className = 'brick';
            document.body.appendChild(brick);
            
            // è·å–ä½ç½®ä¿¡æ¯
            const fromRect = fromPlayer.getBoundingClientRect();
            const toRect = toPlayer.getBoundingClientRect();
            
            // è®¾ç½®ç –å¤´åˆå§‹ä½ç½®
            brick.style.left = (fromRect.left + fromRect.width / 2) + 'px';
            brick.style.top = (fromRect.top + fromRect.height / 2) + 'px';
            
            // è®¡ç®—ç›®æ ‡ä½ç½®
            const targetX = toRect.left + toRect.width / 2;
            const targetY = toRect.top + toRect.height / 2;
            
            // åˆ›å»ºå…³é”®å¸§åŠ¨ç”»
            const keyframes = [
                {
                    left: brick.style.left,
                    top: brick.style.top,
                    transform: 'scale(0.5) rotate(0deg)'
                },
                {
                    left: targetX + 'px',
                    top: targetY + 'px',
                    transform: 'scale(1) rotate(360deg)'
                }
            ];
            
            // æ‰§è¡ŒåŠ¨ç”»
            const animation = brick.animate(keyframes, {
                duration: 500,
                easing: 'ease-out'
            });
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤ç –å¤´å…ƒç´ å¹¶æ˜¾ç¤ºæµæ³ªè¡¨æƒ…
            animation.onfinish = () => {
                brick.remove();
                
                // æ·»åŠ æŠ–åŠ¨æ•ˆæœ
                toPlayer.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    toPlayer.style.animation = '';
                }, 500);
                
                // åˆ›å»ºå¹¶æ˜¾ç¤ºæµæ³ªè¡¨æƒ…
                const cryEmoji = document.createElement('div');
                cryEmoji.className = 'cry-emoji';
                cryEmoji.textContent = 'ğŸ˜­';
                toPlayer.appendChild(cryEmoji);
                
                // 1.5ç§’åç§»é™¤æµæ³ªè¡¨æƒ…
                setTimeout(() => {
                    cryEmoji.remove();
                }, 1500);
            };
        }
        
        // æ·»åŠ æ˜¾ç¤ºç«ç„°ç‰¹æ•ˆçš„å‡½æ•°
        function showFireEffect(playerIndex) {
            const playerDiv = document.querySelector(`.player[data-player-index="${playerIndex}"]`);
            if (!playerDiv || playerDiv.querySelector('.fire-effect')) return;
            
            // åˆ›å»ºç«ç„°æ•ˆæœ
            const fireEffect = document.createElement('div');
            fireEffect.className = 'fire-effect';
            playerDiv.appendChild(fireEffect);
            
            // åˆ›å»ºæ–‡å­—æ•ˆæœ
            const hotText = document.createElement('div');
            hotText.className = 'hot-text';
            hotText.textContent = 'çº¢æ¸©äº†';
            playerDiv.appendChild(hotText);
            
            // åˆ›å»ºå‘æ€’è¡¨æƒ…
            const angryEmoji = document.createElement('div');
            angryEmoji.className = 'angry-emoji';
            angryEmoji.textContent = 'ğŸ˜¡';
            playerDiv.appendChild(angryEmoji);
            
            // 2ç§’åç§»é™¤æ‰€æœ‰æ•ˆæœ
            setTimeout(() => {
                fireEffect.remove();
                hotText.remove();
                angryEmoji.remove();
            }, 2000);
        }

        document.getElementById('refresh-game').onclick = () => {
            location.reload();
        };
    </script>
</body>
</html>
